# searchbnf.conf

[riskmvlookup-command]
syntax = | riskmvlookup source_field=<name of the source field>
description = \
    This streaming custom command handles multivalue asset enrichment for the purpose of RBA
    Syntax: \
    | riskmvlookup source_field=<name of the source field>
comment1 = \
    This example handles the dest field enrichment
example1 = \
    | riskmvlookup source_field="dest"
shortdesc = Handles multivalue asset enrichment for RBA
usage = public
tags = TA-gsoctbox

# Streaming command to load and pretty print json fields
[prettyjson-command]
syntax = | prettyjson fields=<command separated list of fields to pretty print JSON>
description = \
    This streaming command can be used to pretty print a list of JSON fields
    Syntax: \
    | prettyjson fields=<command separated list of fields to pretty print JSON>
comment1 = \
    This example pretty prints a JSON field
example1 = \
    | prettyjson fields="myfield"
shortdesc = Pretty print a list of JSON fields
usage = public
tags = TA-gsoctbox

# Gsoc gen notable
[gsocgennotable-command]
syntax = | gsocgennotable search_name="<value>" rule_name="<value>" rule_title="<value>" orig_host_bunit="<value>" severity="<value>" rule_description="<value>" orig_alert_category="<value>"
description = \
    This generating command is called to create a notable event manually
    Syntax: \
     gsocgennotable search_name="<value>" rule_name="<value>" rule_title="<value>" orig_host_bunit="<value>" severity="<value>" rule_description="<value>" orig_alert_category="<value>"
comment1 = \
    This generating command is called to create a notable event manually
example1 = \
    gsocgennotable search_name="myvalue" rule_name="myvalue" rule_title="myvalue" orig_host_bunit="myvalue" severity="myvalue" rule_description="myvalue" orig_alert_category="myvalue"
shortdesc = Generate a new notable event
usage = public
tags = TA-gsoctbox

# RBA - Generate and maintain ML models
[rbagenmodels-command]
syntax = | rbagenmodels app=<app namespace> owner=<owner> bunit_search_provider="<A splunk search providing the list of entities to be processed>" bunit_search_provider_earliest="<earliest time for that search>" bunit_search_provider_latest="<latest time for that search>" kpis="<comma separated list of KPIs to be processed>" lower_threshold=<default value for lower_threshold, default: 0.005> upper_threshold=<default value for upper_threshold, default: 0.005> time_factor=<default value for time_factor, default: %w%H> earliest_time=<earliest time quantifier for the mstats training search> latest_time=<latest time quantifier for the mstats training search> 
description = \
    This generating command builds and maintain ML models for RBA purposes
    Syntax: \
    | rbagenmodels app=<app namespace> owner=<owner> bunit_search_provider="<A splunk search providing the list of entities to be processed>" bunit_search_provider_earliest="<earliest time for that search>" bunit_search_provider_latest="<latest time for that search>" kpis="<comma separated list of KPIs to be processed>" lower_threshold=<default value for lower_threshold, default: 0.005> upper_threshold=<default value for upper_threshold, default: 0.005> time_factor=<default value for time_factor, default: %w%H> earliest_time=<earliest time quantifier for the mstats training search> latest_time=<latest time quantifier for the mstats training search>
comment1 = \
    This generating command builds and maintain ML models for RBA purposes
example1 = \
    | rbagenmodels app="SplunkEnterpriseSecurity" owner="admin" bunit_search_provider="| mcatalog values(metric_name) as metrics where index=security_siem_metrics risk_object_bunit=* by risk_object_bunit | stats values(risk_object_bunit) as risk_object_bunit" bunit_search_provider_earliest="-7d" bunit_search_provider_latest="now" kpis="rba.cummulative_risk_score,rba.mitre_tactic_id_count" earliest_time="-90d" latest_time="now"
shortdesc = Generate and maintain ML models for RBA
usage = public
tags = TA-gsoctbox

# RBA - Investigate ML models
[rbarenderoutliers-command]
syntax = | rbarenderoutliers app=<app namespace> owner=<owner> bunit_search_provider="<A splunk search providing the list of entities to be processed>" bunit_search_provider_earliest="<earliest time for that search>" bunit_search_provider_latest="<latest time for that search>" kpis="<comma separated list of KPIs to be processed>" earliest_time=<earliest time quantifier for the mstats rendering search> latest_time=<latest time quantifier for the mstats rendering search> 
description = \
    This generating command builds and maintain ML models for RBA purposes
    Syntax: \
    | rbarenderoutliers app=<app namespace> owner=<owner> bunit_search_provider="<A splunk search providing the list of entities to be processed>" bunit_search_provider_earliest="<earliest time for that search>" bunit_search_provider_latest="<latest time for that search>" kpis="<comma separated list of KPIs to be processed>" earliest_time=<earliest time quantifier for the mstats training search> latest_time=<latest time quantifier for the mstats training search>
comment1 = \
    This generating command builds and maintain ML models for RBA purposes
example1 = \
    | rbarenderoutliers app="SplunkEnterpriseSecurity" owner="admin" bunit_search_provider="| inputlookup rba_bunit_mlmodels_config where enabled=1 | table bunit | rename bunit as risk_object_bunit" bunit_search_provider_earliest="-7d" bunit_search_provider_latest="now" kpis="rba.cummulative_risk_score,rba.mitre_tactic_id_count" earliest_time="-90d" latest_time="now"
shortdesc = Generate and maintain ML models for RBA
usage = public
tags = TA-gsoctbox

# RBA - Investigate ML models per BUNIT
[rbarenderoutliersperbunit-command]
syntax = | rbarenderoutliersperbunit app=<app namespace> bunit=<The business unit> kpi="The KPI value"> earliest_time=<earliest time quantifier for the mstats rendering search> latest_time=<latest time quantifier for the mstats rendering search>
description = \
    This generating command builds and maintain ML models for RBA purposes
    Syntax: \
    | rbarenderoutliersperbunit app=<app namespace> bunit=<The business unit> kpi="The KPI value"> earliest_time=<earliest time quantifier for the mstats rendering search> latest_time=<latest time quantifier for the mstats rendering search>
comment1 = \
    This generating command builds and maintain ML models for RBA purposes
example1 = \
    | rbarenderoutliersperbunit app="SplunkEnterpriseSecurity" owner="admin" bunit="mybunit" kpi="rba.cummulative_risk_score" earliest_time="-7d" latest_time="now"
shortdesc = Generate and maintain ML models for RBA
usage = public
tags = TA-gsoctbox

# RBA - Reset risk score
[gsocresetrisk-command]
syntax = | gsocresetrisk risk_object_bunit=<The Risk bunit> risk_object_type=<risk_object_type> risk_object=<risk_object> risk_message=<risk_message> earliest_time=<earliest time quantifier> latest_time=<latest time quantifier> risk_score=<The value for risk score>
description = \
    This generating custom command can be used to retrieve the current risk score for a given risk object, and reset its score by generating the corresponding negative risk score
    Syntax: \
    | gsocresetrisk risk_object_bunit=<The Risk bunit> risk_object_type=<risk_object_type> risk_object=<risk_object> risk_message=<risk_message> earliest_time=<earliest time quantifier> latest_time=<latest time quantifier> risk_score=<The value for risk score>
comment1 = \
    This generating custom command can be used to retrieve the current risk score for a given risk object, and reset its score by generating the corresponding negative risk score
example1 = \
    | gsocresetrisk risk_object_bunit="TEST" risk_object_type="user" risk_object="jsmith" risk_message="This is a false positive" earliest_time="-24h" latest_time="now" risk_score="16"
shortdesc = Resets the risk score of a given risk_object
usage = public
tags = TA-gsoctbox

# CSV mass exexcutor
[gsoccsvmassgen-command]
syntax = | gsocmassexec savedsearch_name=<name of the savedsearch report> simulate=<run in sumulation, True|False>
description = \
    This generating custom command acts as a mass search executor, it takes in input a report generating one or more SPL statement, and sequentially executes the statement
    Syntax: \
    | gsoccsvmassgen savedsearch_name=<name of the savedsearch report> simulate=<run in sumulation, True|False>
comment1 = \
    This generating custom command acts as a mass search executor, it takes in input a report generating one or more SPL statement, and sequentially executes the statement
example1 = \
    | gsoccsvmassgen savedsearch_name="myreport" simulate="False"
shortdesc = Sequential mass executor
usage = public
tags = TA-gsoctbox
